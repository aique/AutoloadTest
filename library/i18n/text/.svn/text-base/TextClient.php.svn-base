<?php

	require_once 'TextId.php';
	require_once 'TextPrinter.php';
	
	class TextClient
	{
		public static function getText($textId, $params = null)
		{
			$textIdObj = new TextId($textId);
			
			$browserSessionState = SessionManager::getVariable(SessionManager::BROWSER_SESSION_STATE);
			$locale = $browserSessionState->getI18nManager()->getLocale();
			
			if(LocaleHelper::hasEnglishUSLocation($locale))
			{
				$text = self::getTextFromFile(INTERNALIZATION_LOCAL_FILES_PATH . LocaleFileHelper::TEXT_ENGLISH_LOCALE_FOLDER, $textIdObj);
			}
			elseif(LocaleHelper::hasSpanishLocation($locale))
			{
				$text = self::getTextFromFile(INTERNALIZATION_LOCAL_FILES_PATH . LocaleFileHelper::TEXT_SPANISH_LOCALE_FOLDER, $textIdObj);
			}
			
			return TextPrinter::doPrint($text, $params);
		}
		
		public static function getEnumerationText($enumeratedObjects)
		{
			$text = "";
			
			$browserSessionState = SessionManager::getVariable(SessionManager::BROWSER_SESSION_STATE);
			$locale = $browserSessionState->getI18nManager()->getLocale();
			
			if(LocaleHelper::hasEnglishUSLocation($locale))
			{
				$text .= self::getEnumerationTextByLanguage($enumeratedObjects, "and", "others");
			}
			elseif(LocaleHelper::hasSpanishLocation($locale))
			{
				$text .= self::getEnumerationTextByLanguage($enumeratedObjects, "y", "otros");
			}
			
			return $text;
		}
		
		private static function getEnumerationTextByLanguage($enumeratedObjects, $lastSeparator, $generalization)
		{
			$text = "";
			
			$maxNumElements = 4;
			
			if(count($enumeratedObjects) == 1)
			{
				$text .= '<span>'.$enumeratedObjects[0].'</span>';
			}
			elseif(count($enumeratedObjects) > 1 && count($enumeratedObjects) < $maxNumElements)
			{
				for($i = 0 ; $i < count($enumeratedObjects) ; $i++)
				{
					if($i < count($enumeratedObjects) - 2)
					{
						$text .= '<span>'.$enumeratedObjects[$i].'</span>';
						
						$text .= ', ';
					}

					if($i == count($enumeratedObjects) - 2)
					{
						$text .= '<span>'.$enumeratedObjects[$i].'</span>';
					}
				
					if($i == count($enumeratedObjects) - 1)
					{
						$text .= ' '.$lastSeparator.' ';
						
						$text .= '<span>'.$enumeratedObjects[$i].'</span>';
					}
				}
			}
			else
			{
				for($i = 0 ; $i < $maxNumElements ; $i++)
				{
					if($i < $maxNumElements - 2)
					{
						$text .= '<span>'.$enumeratedObjects[$i].'</span>';
						
						$text .= ', ';
					}
					
					if($i == $maxNumElements - 2)
					{
						$text .= '<span>'.$enumeratedObjects[$i].'</span>';
					}
				
					if($i == $maxNumElements - 1)
					{
						$text .= ' '.$lastSeparator.' '.$generalization.' ';
					}
				}
			}
			
			return $text;
		}
		
		private static function getTextFromFile($path, $textId)
		{
			$ifm = new I18nFileManager($path, $textId);
			$text = $ifm->getText($textId);
			return $text;
		}
		
	}

?>