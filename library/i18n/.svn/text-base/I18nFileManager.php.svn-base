<?php

	/**
	 * Get the info from the locale files.
	 * 
	 * @author [Q]
	 */
	class I18nFileManager
	{
		private $fileContents;
		
		public function __construct($path = null, $textId = null)
		{
			if($textId)
			{
				$file = $path . "/" . $textId->getType() . "/" . $textId->getMedia() . "/" . $textId->getPage() . ".txt";
			}
			else
			{
				$file = $path;
			}
			
			if($path)
			{
				$handler = fopen($file, "r");
				$this->fileContents = fread($handler, filesize($file));
				fclose($handler);
			}
		}
		
		/**
		 * Get the text in the locale files tagged with the label
		 * received as a parameter.
		 * 
		 * @param TextId $textIdObj
		 * 
		 * 		Object which contains the label information to
		 * 		get the text.
		 */
		public function getText($textIdObj)
		{
			$lines = explode("\n", $this->fileContents);
			$text = "";
			
			foreach ($lines as $line)
			{	
				$separatorPosition = stripos($line, ":");
				
				$textId = substr($line, 0, $separatorPosition);
				$textContent = substr($line, stripos($line, "\""), strrpos($line, "\""));
				
				$currentTextId = new TextId($textId);
				
				if($currentTextId->getId() == $textIdObj->getId())
				{
					$text = $textContent;
				}
			}	
			
			$text = trim($text);		
			return str_replace("\"", "", $text);
		}
		
		public function putText($path, $label, $value)
		{
			$handler = fopen($path, "a");
			fwrite($handler, $label . ":" . "\"" . $value . "\"\n");
			fclose($handler);
		}
		
	}
	
?>